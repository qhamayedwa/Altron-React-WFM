{% extends "base.html" %}

{% block title %}Payroll Configuration - {{ config.APP_NAME }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">Payroll Configuration</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('payroll.payroll_processing') }}">Payroll</a></li>
                        <li class="breadcrumb-item active">Configuration</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <!-- Configuration Card -->
    <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i data-feather="settings" class="me-2"></i>
                        Payroll System Configuration
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-4">
                        <i data-feather="info" class="me-2"></i>
                        <strong>Important:</strong> These settings apply to all payroll calculations. Changes take effect immediately for new calculations.
                    </div>

                    <form method="POST" action="{{ url_for('payroll.save_payroll_configuration') }}">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="base_rate" class="form-label">
                                        <i data-feather="dollar-sign" class="me-1"></i>
                                        Base Hourly Rate (ZAR)
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">R</span>
                                        <input type="number" class="form-control" id="base_rate" name="base_rate" 
                                               value="{{ config.base_rate }}" min="0" max="1000" step="0.01" required>
                                        <span class="input-group-text">/hour</span>
                                    </div>
                                    <div class="form-text">Standard hourly rate for regular time (R0 - R1000)</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="deduction_rate" class="form-label">
                                        <i data-feather="minus-circle" class="me-1"></i>
                                        Deduction Rate
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="deduction_rate" name="deduction_rate" 
                                               value="{{ config.deduction_rate }}" min="0" max="0.5" step="0.01" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <div class="form-text">Percentage deducted from gross pay (0% - 50%)</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="overtime_multiplier" class="form-label">
                                        <i data-feather="clock" class="me-1"></i>
                                        Overtime Multiplier
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="overtime_multiplier" name="overtime_multiplier" 
                                               value="{{ config.overtime_multiplier }}" min="1.0" max="5.0" step="0.1" required>
                                        <span class="input-group-text">x</span>
                                    </div>
                                    <div class="form-text">Multiplier for overtime hours (1.0x - 5.0x)</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="double_time_multiplier" class="form-label">
                                        <i data-feather="fast-forward" class="me-1"></i>
                                        Double Time Multiplier
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="double_time_multiplier" name="double_time_multiplier" 
                                               value="{{ config.double_time_multiplier }}" min="1.0" max="5.0" step="0.1" required>
                                        <span class="input-group-text">x</span>
                                    </div>
                                    <div class="form-text">Multiplier for double time hours (1.0x - 5.0x)</div>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Current Calculation Preview -->
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i data-feather="calculator" class="me-2"></i>
                                    Current Rate Structure
                                </h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <div class="h4 text-success">R{{ "%.2f"|format(config.base_rate) }}</div>
                                            <small class="text-muted">Regular Time</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <div class="h4 text-warning">R{{ "%.2f"|format(config.base_rate * config.overtime_multiplier) }}</div>
                                            <small class="text-muted">Overtime ({{ config.overtime_multiplier }}x)</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <div class="h4 text-danger">R{{ "%.2f"|format(config.base_rate * config.double_time_multiplier) }}</div>
                                            <small class="text-muted">Double Time ({{ config.double_time_multiplier }}x)</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center mt-3">
                                    <div class="h6 text-info">
                                        Deductions: {{ "%.0f"|format(config.deduction_rate * 100) }}% 
                                        <small class="text-muted">(Net pay = {{ "%.0f"|format((1 - config.deduction_rate) * 100) }}% of gross)</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a href="{{ url_for('payroll.payroll_processing') }}" class="btn btn-secondary">
                                <i data-feather="arrow-left" class="me-2"></i>
                                Back to Payroll
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i data-feather="save" class="me-2"></i>
                                Save Configuration
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Information -->
    <div class="row mt-4">
        <div class="col-lg-8 col-md-10 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i data-feather="help-circle" class="me-2"></i>
                        Configuration Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Rate Configuration</h6>
                            <ul class="list-unstyled">
                                <li><i data-feather="check" class="text-success me-2"></i>Base rate applies to regular working hours</li>
                                <li><i data-feather="check" class="text-success me-2"></i>Overtime typically 1.5x for hours 41-48</li>
                                <li><i data-feather="check" class="text-success me-2"></i>Double time typically 2.0x for hours 49+</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Deduction Guidelines</h6>
                            <ul class="list-unstyled">
                                <li><i data-feather="info" class="text-info me-2"></i>Includes tax, UIF, and other statutory deductions</li>
                                <li><i data-feather="info" class="text-info me-2"></i>Standard South African rate is approximately 25%</li>
                                <li><i data-feather="info" class="text-info me-2"></i>Consult with HR/Finance for exact percentages</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update preview when values change
    const inputs = ['base_rate', 'overtime_multiplier', 'double_time_multiplier', 'deduction_rate'];
    
    inputs.forEach(id => {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('input', updatePreview);
        }
    });
    
    function updatePreview() {
        const baseRate = parseFloat(document.getElementById('base_rate').value) || 150;
        const overtimeMultiplier = parseFloat(document.getElementById('overtime_multiplier').value) || 1.5;
        const doubleTimeMultiplier = parseFloat(document.getElementById('double_time_multiplier').value) || 2.0;
        const deductionRate = parseFloat(document.getElementById('deduction_rate').value) || 0.25;
        
        // Update preview values (would need to select the preview elements and update them)
        console.log('Preview updated:', {baseRate, overtimeMultiplier, doubleTimeMultiplier, deductionRate});
    }
});
</script>
{% endblock %}